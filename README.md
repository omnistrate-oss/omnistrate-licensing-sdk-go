# Omnistrate Licensing SDK for Go

![CI](https://github.com/omnistrate-oss/omnistrate-licensing-sdk-go/actions/workflows/build.yml/badge.svg) 
![CodeQL](https://github.com/omnistrate-oss/omnistrate-licensing-sdk-go/actions/workflows/codeql.yml/badge.svg)

## Overview

[omnistrate-licensing-sdk-go](https://github.com/omnistrate-oss/omnistrate-licensing-sdk-go) is an SDK that allow to validate license files generated by Omnistrate. 

## Installation

To install the necessary dependencies, run:
```sh
go get -u github.com/omnistrate-oss/omnistrate-licensing-sdk-go
```

## Usage Examples

### Pre requisites

The `Licensing` feature needs to be enabled for the service plan. When enabling the feature a product identifier can be optionally configured. That value can then be optionally used to Validate the license. 

Docker compose example: 
```yaml
x-customer-integrations:
  licensing: 
    # optional - defaults to 7 days
    licenseExpirationInDays: 7
    # optional - identifier (shared secret) that can be used to add extra security on validation - defaults to product tier id
    productPlanUniqueIdentifier: '[product plan unique id]' 
```

When used on a Container based resource, Omnistrate takes care of mounting the secret and setting the environment variables for verification. 

Service spec configuration:
```yaml
features:
  licensing:
    # optional - defaults to 7 days
    licenseExpirationInDays: 7 
    # optional - identifier (shared secret) that can be used to add extra security on validation - defaults to product tier id
    productPlanUniqueIdentifier: '[product plan unique id]'

```

When using Helm or Operator the secret `service-plan-subscription-license` generated with the license needs to be mounted on `/var/subscription/`

## Usage

During startup and periodically, implement the following check:

### ValidateLicenseForProduct

Alternatively, if a value is set for the `productPlanUniqueIdentifier` field, this method can be used to add extra security, ensuring the license was generated for the specific product plan. 

```go
package main

import (
	"fmt"
	"github.com/omnistrate-oss/omnistrate-licensing-sdk-go/pkg/validator"
)

func main() {
	err := validator.ValidateLicenseForProduct("[org-id]", "[product plan unique id]")  value should be hardcoded, based on the value configured when enabling the feature
	if err != nil {
		fmt.Println("License validation for product failed:", err)
	} else {
		fmt.Println("License validation for product succeeded")
	}
}
```

## Contributing

Want to contribute? Awesome! You can find information about contributing to this
project in the [CONTRIBUTING](/CONTRIBUTING.md) page

## About Omnistrate

[Omnistrate](https://omnistrate.com/) is the operating system for your SaaS,
offering enterprise-grade capabilities: automated provisioning, serverless
capabilities, auto-scaling, billing, monitoring, centralized logging,
self-healing, intelligent patching and much more!
